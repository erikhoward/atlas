# PII Detection Pattern Library
# This file contains regex patterns for detecting PHI/PII in OpenEHR compositions
# Patterns are organized by HIPAA Safe Harbor categories and GDPR quasi-identifiers

[patterns.name]
# Personal names - first, middle, last, titles
patterns = [
    # Titles followed by names
    '(?i)\b(dr|mr|mrs|ms|miss|prof|professor|sir|madam|lord|lady)\.?\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b',
    # Full names (First Middle? Last)
    '\b[A-Z][a-z]{2,}\s+(?:[A-Z][a-z]{1,}\s+)?[A-Z][a-z]{2,}\b',
]
confidence = 0.85
category = "NAME"

[patterns.email]
# Email addresses
patterns = [
    '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b',
]
confidence = 0.99
category = "EMAIL"

[patterns.phone]
# Phone numbers - US, international, E.164
patterns = [
    # US format: (123) 456-7890, 123-456-7890, 123.456.7890
    '\b(?:\+?1[-.\s]?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})\b',
    # International E.164: +1234567890
    '\+[1-9]\d{1,14}\b',
    # UK format: +44 20 1234 5678
    '\+44\s?\d{2,4}\s?\d{4}\s?\d{4}\b',
]
confidence = 0.95
category = "PHONE"

[patterns.ssn]
# US Social Security Numbers
patterns = [
    # Format: 123-45-6789
    '\b\d{3}-\d{2}-\d{4}\b',
    # Format: 123 45 6789
    '\b\d{3}\s\d{2}\s\d{4}\b',
]
confidence = 0.99
category = "SSN"

[patterns.date]
# Date patterns - ISO 8601, US, EU formats
patterns = [
    # ISO 8601: 2024-01-15, 2024/01/15
    '\b\d{4}[-/](0[1-9]|1[0-2])[-/](0[1-9]|[12]\d|3[01])\b',
    # US format: 01/15/2024, 01-15-2024
    '\b(0[1-9]|1[0-2])[-/](0[1-9]|[12]\d|3[01])[-/]\d{4}\b',
    # EU format: 15/01/2024, 15-01-2024
    '\b(0[1-9]|[12]\d|3[01])[-/](0[1-9]|1[0-2])[-/]\d{4}\b',
    # Month Day, Year: January 15, 2024
    '(?i)\b(january|february|march|april|may|june|july|august|september|october|november|december)\s+(0?[1-9]|[12]\d|3[01]),?\s+\d{4}\b',
]
confidence = 0.90
category = "DATE"

[patterns.mrn]
# Medical Record Numbers - common formats
patterns = [
    # MRN prefix patterns
    '(?i)\b(mrn|medical\s*record\s*number|patient\s*id)[\s:]*([A-Z0-9]{6,12})\b',
    # Standalone alphanumeric IDs (6-12 chars)
    '\b[A-Z]{2,3}\d{6,10}\b',
]
confidence = 0.80
category = "MEDICAL_RECORD_NUMBER"

[patterns.ip_address]
# IP addresses - IPv4 and IPv6
patterns = [
    # IPv4: 192.168.1.1
    '\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b',
    # IPv6 (simplified)
    '\b(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}\b',
]
confidence = 0.95
category = "IP_ADDRESS"

[patterns.url]
# Web URLs
patterns = [
    # HTTP/HTTPS URLs
    '\b(?:https?://)?(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&/=]*)',
]
confidence = 0.90
category = "URL"

[patterns.geographic_location]
# Geographic locations - addresses, cities, ZIP codes
patterns = [
    # US ZIP codes: 12345 or 12345-6789
    '\b\d{5}(?:-\d{4})?\b',
    # UK postcodes: SW1A 1AA
    '\b[A-Z]{1,2}\d{1,2}[A-Z]?\s?\d[A-Z]{2}\b',
    # Street addresses (simplified)
    '\b\d+\s+[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\s+(?:Street|St|Avenue|Ave|Road|Rd|Boulevard|Blvd|Lane|Ln|Drive|Dr|Court|Ct)\b',
]
confidence = 0.85
category = "GEOGRAPHIC_LOCATION"

[patterns.account_number]
# Account numbers
patterns = [
    # Account number with prefix
    '(?i)\b(account|acct)[\s#:]*([A-Z0-9]{8,16})\b',
    # Standalone numeric accounts
    '\b\d{10,16}\b',
]
confidence = 0.75
category = "ACCOUNT_NUMBER"

[patterns.device_identifier]
# Device identifiers and serial numbers
patterns = [
    # Serial number patterns
    '(?i)\b(serial|s/n|sn)[\s#:]*([A-Z0-9]{6,20})\b',
    # Device ID patterns
    '(?i)\b(device\s*id|device\s*identifier)[\s:]*([A-Z0-9]{6,20})\b',
]
confidence = 0.80
category = "DEVICE_IDENTIFIER"

[patterns.vehicle_identifier]
# Vehicle identifiers - license plates
patterns = [
    # US license plate patterns (simplified)
    '\b[A-Z]{2,3}[-\s]?\d{3,4}\b',
    # VIN (Vehicle Identification Number)
    '\b[A-HJ-NPR-Z0-9]{17}\b',
]
confidence = 0.85
category = "VEHICLE_IDENTIFIER"

# GDPR Quasi-Identifiers

[patterns.occupation]
# Occupation/profession references
patterns = [
    '(?i)\b(occupation|profession|job\s*title)[\s:]+([A-Za-z\s]{3,30})\b',
    '(?i)\b(doctor|nurse|engineer|teacher|lawyer|accountant|manager|developer|analyst|consultant)\b',
]
confidence = 0.70
category = "OCCUPATION"

[patterns.education_level]
# Education level references
patterns = [
    '(?i)\b(education|degree|diploma)[\s:]+([A-Za-z\s]{3,30})\b',
    '(?i)\b(bachelor|master|phd|doctorate|high\s*school|college|university)\b',
]
confidence = 0.70
category = "EDUCATION_LEVEL"

[patterns.marital_status]
# Marital status
patterns = [
    '(?i)\b(marital\s*status)[\s:]+([A-Za-z\s]{3,20})\b',
    '(?i)\b(married|single|divorced|widowed|separated)\b',
]
confidence = 0.75
category = "MARITAL_STATUS"

[patterns.ethnicity]
# Ethnicity/race references
patterns = [
    '(?i)\b(ethnicity|race)[\s:]+([A-Za-z\s]{3,30})\b',
    '(?i)\b(caucasian|african|asian|hispanic|latino|indigenous)\b',
]
confidence = 0.70
category = "ETHNICITY"

[patterns.age]
# Age references
patterns = [
    '(?i)\b(age)[\s:]+(\d{1,3})\s*(years?|yrs?|y\.?o\.?)?\b',
    '\b(\d{1,3})\s*(?:years?\s*old|yrs?\s*old|y\.?o\.?)\b',
]
confidence = 0.85
category = "AGE"

