# Atlas Configuration Example - PostgreSQL Backend
# This is a sample configuration file for Atlas ETL tool using PostgreSQL

[application]
name = "atlas"
version = "2.0.0"
log_level = "info" # trace, debug, info, warn, error
dry_run = false

[openehr]
# EHRBase server endpoint
base_url = "https://ehrbase.example.com/ehrbase/rest/openehr/v1"
vendor = "ehrbase"                                               # Vendor-specific implementation

# Authentication
# Security: Credentials are securely handled in memory and never logged
auth_type = "basic"                    # basic | openid (future)
username = "atlas_user"
password = "${ATLAS_OPENEHR_PASSWORD}" # Env var substitution recommended

# TLS settings
tls_verify = true
# tls_ca_cert = "/path/to/ca.crt"  # Optional

[openehr.query]
# Export filters
template_ids = ["IDCR - Adverse Reaction List.v1", "IDCR - Problem List.v1"]
ehr_ids = []                              # Empty = all EHRs
time_range_start = "2024-01-01T00:00:00Z" # ISO 8601 or null
time_range_end = null                     # null = now

# Batch processing
batch_size = 1000 # 100-5000
parallel_ehrs = 8 # Concurrent EHR processing

[export]
mode = "incremental"                   # full | incremental
export_composition_format = "preserve" # preserve | flatten

# Retry settings
max_retries = 3
retry_backoff_ms = [1000, 2000, 4000] # Exponential backoff

# Database target selection
database_target = "postgresql" # postgresql | cosmosdb

[postgresql]
# PostgreSQL connection string
# Format: postgresql://[user[:password]@][host][:port][/dbname][?param1=value1&...]
# Security: Connection string (including password) is securely handled in memory and never logged
connection_string = "postgresql://atlas_user:${ATLAS_PG_PASSWORD}@localhost:5432/openehr_data?sslmode=require"

# Connection pool settings
max_connections = 20            # Maximum number of connections in the pool
connection_timeout_seconds = 30 # Timeout for acquiring a connection
statement_timeout_seconds = 60  # Timeout for executing a statement

# SSL/TLS mode
# Options: disable, allow, prefer, require, verify-ca, verify-full
ssl_mode = "require"

[state]
# State management
enable_checkpointing = true
checkpoint_interval_seconds = 30

[verification]
# Optional data verification
enable_verification = false
checksum_algorithm = "sha256"

[logging]
# Local logging
local_enabled = true
local_path = "/var/log/atlas"
local_rotation = "daily"      # daily | size
local_max_size_mb = 100

# Azure Log Analytics (optional)
# Security: Azure client secret is securely handled in memory and never logged
azure_enabled = false
# azure_tenant_id = "${AZURE_TENANT_ID}"
# azure_client_id = "${AZURE_CLIENT_ID}"
# azure_client_secret = "${AZURE_CLIENT_SECRET}"  # Use environment variable for security
# azure_log_analytics_workspace_id = "${AZURE_LOG_ANALYTICS_WORKSPACE_ID}"
# azure_dcr_immutable_id = "${AZURE_DCR_IMMUTABLE_ID}"
# azure_dce_endpoint = "${AZURE_DCE_ENDPOINT}"
# azure_stream_name = "Custom-AtlasExport_CL"
